知识库命中测试API
========

文本生成应用无会话支持，适合用于翻译/文章写作/总结 AI 等等。


## 接口文档

### 请求接口

| 项目 | 说明 |
|------|------|
| **方法** | POST |
| **请求URL** | `http://localhost:8081/service/api/openapi/v1/knowledge/hit` |
| 字符编码             | UTF-8                                                    |
| 请求类型             | POST                                                     |
| 鉴权方式(header参数) | `Authorization: Bearer {API Key}`                        |
| 请求格式             | `Content-Type: application/json`                         |
| 响应格式             | `Content-Type: application/json` |

---

### 请求参数（JSON Body）

#### 顶层参数

| 参数名 | 必填 | 类型 | 说明 |
|--------|------|------|------|
| `knowledgeList` | 否 | Array[[AppKnowledgeBase](#appknowledgebase-对象)] | 知识库列表 |
| `question` | **是** | String | 用户问题 |
| `knowledgeMatchParams` | **是** | [KnowledgeMatchParams](#knowledgematchparams-对象) | 知识匹配参数配置 |
| `commonCheck` | 否 | Object | 通用校验参数（具体字段根据实际`CommonCheck`结构） |

---

### 对象结构说明

#### AppKnowledgeBase 对象

| 字段名 | 必填 | 类型 | 说明 |
|--------|------|------|------|
| `id` | **是** | String | 知识库ID |
| `metaDataFilterParams` | 否 | [MetaDataFilterParams](#metadatafilterparams-对象) | 元数据过滤参数 |

#### KnowledgeMatchParams 对象

| 字段名 | 必填 | 类型 | 说明                                                                     |
|--------|------|------|------------------------------------------------------------------------|
| `matchType` | **是** | String | 匹配类型：<br>• `vector` - 向量检索<br>• `text` - 文本检索<br>• `mix` - 混合检索（向量+文本） |
| `rerankModelId` | 否 | String | 重排序模型UUID                                                              |
| `priorityMatch` | 否 | Integer | 权重匹配开关（仅在混合检索模式下生效）：<br>• `0` - 关闭<br>• `1` - 开启                       |
| `semanticsPriority` | 否 | Float | 语义权重（当`priorityMatch=1`时有效）                                            |
| `keywordPriority` | 否 | Float | 关键词权重（当`priorityMatch=1`时有效）                                           |
| `topK` | 否 | Integer | 返回结果数量（topK值）                                                          |
| `threshold` | 否 | Float | 相似度过滤阈值                                                                |
| `termWeight` | 否 | Float | 关键词系数                                                                  |
| `termWeightEnable` | 否 | Boolean | 关键词系数开关                                                                |
| `useGraph` | 否 | Boolean | 是否使用知识图谱                                                               |
| `commonCheck` | 否 | Object | 通用校验参数                                                                 |

#### MetaDataFilterParams 对象

| 字段名 | 必填 | 类型 | 说明 |
|--------|------|------|------|
| `filterEnable` | 否 | Boolean | 元数据过滤开关 |
| `metaFilterParams` | 否 | Array[[MetaFilterParams](#metafilterparams-对象)] | 元数据过滤参数列表 |
| `filterLogicType` | 否 | String | 过滤逻辑类型：<br>• `and` - 与条件<br>• `or` - 或条件 |

#### MetaFilterParams 对象

| 字段名 | 必填 | 类型 | 说明 |
|--------|------|------|------|
| `key` | **是** | String | 元数据字段键名 |
| `type` | **是** | String | 数据类型：<br>• `Time` - 时间<br>• `String` - 字符串<br>• `Number` - 数字 |
| `condition` | **是** | String | 过滤条件（如：`=`、`>`、`<`、`like`等） |
| `value` | **是** | String | 过滤值 |

---
## 调用示例-向量检索

```shell
curl -k --location 'http://localhost:8081/service/api/openapi/v1/knowledge/hit' \
--header 'Content-Type: application/json' \
--header 'Accept: application/json' \
--header 'Authorization: Bearer <API Key>' \
--data '{
    "knowledgeMatchParams": {
        "keywordPriority": 0.8,
        "matchType": "vector",
        "priorityMatch": 0,
        "rerankModelId": "2004082766362185728",
        "semanticsPriority": 0.2,
        "topK": 5,
        "threshold": 0.4,
        "useGraph": false
    },
    "knowledgeList": [
        {
            "metaDataFilterParams": {
                "filterEnable": false,
                "filterLogicType": "and",
                "metaFilterParams": [

                ]
            },
            "id": "2003716670903816192"
        }
    ],
    "question": "开票信息"
}'
```

## 调用示例-全文检索

```shell
curl -k --location 'http://localhost:8081/service/api/openapi/v1/knowledge/hit' \
--header 'Content-Type: application/json' \
--header 'Accept: application/json' \
--header 'Authorization: Bearer <API Key>' \
--data '{
    "knowledgeMatchParams": {
        "keywordPriority": 0.8,
        "matchType": "text",
        "priorityMatch": 0,
        "rerankModelId": "2004082766362185728",
        "semanticsPriority": 0.2,
        "topK": 5,
        "threshold": 0.4,
        "useGraph": false
    },
    "knowledgeList": [
        {
            "metaDataFilterParams": {
                "filterEnable": false,
                "filterLogicType": "and",
                "metaFilterParams": [

                ]
            },
            "id": "2003716670903816192"
        }
    ],
    "question": "开票信息"
}'
```

## 调用示例-混合检索（rerank）

```shell
curl -k --location 'http://localhost:8081/service/api/openapi/v1/knowledge/hit' \
--header 'Content-Type: application/json' \
--header 'Accept: application/json' \
--header 'Authorization: Bearer <API Key>' \
--data '{
    "knowledgeMatchParams": {
        "keywordPriority": 0.8,
        "matchType": "mix",
        "priorityMatch": 0,
        "rerankModelId": "2004082766362185728",
        "semanticsPriority": 0.2,
        "topK": 5,
        "threshold": 0.4,
        "useGraph": false
    },
    "knowledgeList": [
        {
            "metaDataFilterParams": {
                "filterEnable": false,
                "filterLogicType": "and",
                "metaFilterParams": [

                ]
            },
            "id": "2003716670903816192"
        }
    ],
    "question": "开票信息"
}'
```
## 调用示例-混合检索（权重设置）

```shell
curl -k --location 'http://localhost:8081/service/api/openapi/v1/knowledge/hit' \
--header 'Content-Type: application/json' \
--header 'Accept: application/json' \
--header 'Authorization: Bearer <API Key>' \
--data '{
    "knowledgeMatchParams": {
        "keywordPriority": 0.8,
        "matchType": "mix",
        "priorityMatch": 1,
        "rerankModelId": "",
        "semanticsPriority": 0.2,
        "topK": 5,
        "threshold": 0.4,
        "useGraph": false
    },
    "knowledgeList": [
        {
            "metaDataFilterParams": {
                "filterEnable": false,
                "filterLogicType": "and",
                "metaFilterParams": [

                ]
            },
            "id": "2003716670903816192"
        }
    ],
    "question": "开票信息"
}'
```
### 响应示例


```json
{
  "code": 0,
  "data": {
    "prompt": "\n你是一个问答助手，主要任务是汇总参考信息回答用户问题, 请只根据参考信息中提供的上下文信息回答用户问题。\n\n\n用户问题：\n开票信息\n参考信息\n```\nAI科技中心开票信息 \nAI科技中心最新开票信息： \n公司名称：中国联合网络通信有限公司北京人工智能科技中心 \n纳税人识别号：91110102MADD54BA28\n地址电话：北京市西城区西单北大街甲133号10层1011 66115431\n开户行及账号：中国工商银行股份有限公司北京西单支行 0200210309200177274\n```\n输出要求\n 1. **参考信息文字输出要求**：基于参考信息，输出文字内容。\n 2. **参考信息中提及图片链接情况的输出要求**：若参考信息提及图片链接且链接格式符合markdown语法规范：“![图片标题](图片链接)” 。请按此链接格式将相关图像内容附加输出，注意确保图片链接格式完整不被截断。若参考信息未提及图片链接则忽略此规则并注意不要随意捏造图片链接，在答案输出中不要体现此条指令信息的任何内容。\n 3. **输出语言要求**：必须使用与问题相同的语言回答用户的问题。\n",
    "searchList": [
      {
        "title": "AI科技中心开票信息.docx",
        "snippet": "AI科技中心开票信息 \nAI科技中心最新开票信息： \n公司名称：中国联合网络通信有限公司北京人工智能科技中心 \n纳税人识别号：91110102MADD54BA28\n地址电话：北京市西城区西单北大街甲133号10层1011 66115431\n开户行及账号：中国工商银行股份有限公司北京西单支行 0200210309200177274",
        "knowledgeName": "2003716670903816193",
        "childContentList": [],
        "childScore": [],
        "contentType": ""
      }
    ],
    "score": [
      0.6106349229812622
    ],
    "useGraph": false
  },
  "msg": ""
}
```
