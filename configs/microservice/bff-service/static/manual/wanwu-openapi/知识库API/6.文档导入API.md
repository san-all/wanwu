文档导入API
==========

## 文档导入API

文档导入通过配置分段方式对上传的文档进行文档解析。

### 请求接口

----

| Type     | Instructions                                                         |
| -------- | ------------------------------------------------------------ |
| 方法     | Http                                                         |
| 请求URL  | 按照应用实际API根地址，例如：<br />`http://localhost:8081/service/api/openapi/v1/knowledge/doc/import` |
| 调用方式 | 异步调用                                           |
| 字符编码 | UTF-8                                                        |
| 请求类型 | POST                                                         |
| 鉴权方式(header参数) | `Authorization: Bearer {API Key}` |
| 请求格式 | `Content-Type: application/json`              |
| 响应格式 | `Content-Type: application/json`                             |

### 请求参数

----

| Parameter    | Required | Type   | Instructions                         |
|--------------|----------| ------ |--------------------------------------|
| knowledgeId  | 是        | string   | 知识库id                                |
| docInfoList  | 是        | object array | 上传文档列表                               |
| docImportType | 是        | int | 文档导入类型，0：文件上传，1：单条url上传，2.文件url上传    |
| docSegment   | 是        | object | 文档分段配置                               |
| docAnalyzer  | 是        | string array | 文档解析类型 text / ocr  / model           |
| parserModelId  | 否        | string | 模型解析或ocr模型的uuid                      |
| docPreprocess  | 是        | string array | 文本预处理规则 replaceSymbols / deleteLinks |
| docMetaData  | 否        | obejct array | 元数据列表                                |

#### docInfoList中详细字段

| Parameter    | Required | Type   | Instructions                     |
|--------------|----------| ------ |------------------------|
| docId   | 是        | string | 文档id     |
| docName | 是        | string | 文档名称   |
| docUrl  | 否        | string | 文档url    |
| docType | 是        | string | 文档类型   |
| docSize | 否        | string | 文档大小   |

#### docSegment中详细字段

| Parameter    | Required  | Type   | Instructions                     |
|--------------|-----| ------ |------------------------|
| segmentMethod   | 是 | string | 分段方法 0：通用分段；1：父子分段     |
| segmentType     | 否 | string | 分段方式，只有通用分段必填 0：自动分段；1：自定义分段   |
| splitter        | 否 | string array | 分隔符（只有自定义分段必填）    |
| maxSplitter     | 否 | int | 可分隔最大值（只有自定义分段必填）   |
| overlap         | 否 | float32 | 可重叠值（只有自定义分段必填）    |
| subSplitter     | 否 | string array | 子分隔符（只有父子分段必填）    |
| subMaxSplitter  | 否 | int | 可分隔最大值（只有父子分段必填）    |

#### docMetaData中详细字段

| Parameter    | Required | Type   | Instructions                     |
|--------------|----------| ------ |------------------------|
| metaId        | 否        | string | 元数据id     |
| metaKey       | 是        | string | 元数据key   |
| metaValue     | 是        | string | 元数据值    |
| metaValueType | 是        | string | string，number，time   |
| metaRule      | 否        | string | 正则表达式    |
| option        | 是        | string | option:add(新增)、update(更新)、delete(删除),update 和delete 的时候metaId 不能为空    |



### 响应参数

----

| Parameter  | Type     | Instructions   |
| ---- | ------ | ---- |
| code | int    | 状态码  |
| data | json   | 上传文件信息 |
| msg  | string | 返回信息 |



### 请求示例-通用分段-文字提取

----

```shell
curl --location 'http://localhost:8081/service/api/openapi/v1/knowledge/doc/import' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer {API Key}' \
--data '{
  "docAnalyzer": [
    "text"
  ],
  "docMetaData": [],
  "docPreprocess": [
    "replaceSymbols"
  ],
  "docSegment": {
    "segmentType": "0",
    "segmentMethod": "0",
    "subMaxSplitter": 200,
    "subSplitter": [
      "\n"
    ]
  },
  "docInfoList": [
    {
      "docId": "8b4139e0-6fd7-4673-bb21-bb32a9c53f48.docx",
      "docName": "1.docx",
      "docType": ".docx"
    }
  ],
  "docImportType": 0,
  "knowledgeId": "1998659550177136640",
  "parserModelId": ""
}'
```

### 请求示例-自定义分段-启用ocr解析

----

```shell
curl --location 'http://localhost:8081/service/api/openapi/v1/knowledge/doc/import' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer {API Key}' \
--data '{
  "docAnalyzer": [
    "text",
    "ocr"
  ],
  "docMetaData": [
    {
      "metaId": "",
      "metaKey": "time",
      "metaRule": "",
      "metaValue": "1765814400000",
      "metaValueType": "time",
      "showEdit": true,
      "option": "add",
      "typeWithFolderOptions": [
        {
          "label": "Time",
          "value": "time"
        }
      ]
    }
  ],
  "docPreprocess": [
    "replaceSymbols",
    "deleteLinks"
  ],
  "docSegment": {
    "segmentType": "1",
    "splitter": [
      "\n\n"
    ],
    "maxSplitter": 1024,
    "overlap": 0.2,
    "segmentMethod": "0",
    "subMaxSplitter": 200,
    "subSplitter": [
      "\n"
    ]
  },
  "docInfoList": [
    {
      "docId": "7d9278da-b512-407e-92bd-f108061d1d95.txt",
      "docName": "2.txt",
      "docType": ".txt"
    }
  ],
  "docImportType": 0,
  "knowledgeId": "2004457610358558720",
  "parserModelId": "2004027523746238517"
}'
```

### 请求示例-父子分段-模型解析

----

```shell
curl --location 'http://localhost:8081/service/api/openapi/v1/knowledge/doc/import' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer {API Key}' \
--data '{
  "docAnalyzer": [
    "text",
    "model"
  ],
  "docMetaData": [
    {
      "metaId": "",
      "metaKey": "time",
      "metaRule": "",
      "metaValue": "1766419200000",
      "metaValueType": "time",
      "showEdit": true,
      "option": "add",
      "typeWithFolderOptions": [
        {
          "label": "Time",
          "value": "time"
        }
      ]
    }
  ],
  "docPreprocess": [
    "replaceSymbols"
  ],
  "docSegment": {
    "segmentType": "0",
    "splitter": [
      "a",
      "KK",
      "xx",
      "\n\n"
    ],
    "maxSplitter": 1024,
    "overlap": 0.2,
    "segmentMethod": "1",
    "subMaxSplitter": 200,
    "subSplitter": [
      "xx",
      "SS",
      "YY",
      "\n"
    ]
  },
  "docInfoList": [
    {
      "docId": "11879528-ae68-437e-9cbe-96251de7d0c3.pdf",
      "docName": "P020221028794021217146.pdf",
      "docType": ".pdf"
    }
  ],
  "docImportType": 0,
  "knowledgeId": "2004457610358558720",
  "parserModelId": "2004027523804958723"
}'
```

### 响应示例

----------

```json
{
  "code": 0,
  "data": null,
  "msg": ""
}
```
